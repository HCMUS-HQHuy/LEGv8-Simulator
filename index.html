<!DOCTYPE html>
<html>
<head>
<title>Datapath Components (Animated Line - Fixed)</title>
<link rel="stylesheet" href="Styles/linepath.css">
</head>
<body>

<button id="startButton">Chạy Animation PC -> Add</button>
<hr>

<div class="frame" id="zoomFrame">
  <div class="content" id="zoomContent">
  <svg viewBox="0 0 1500 1000">
    <!-- Components Layer (Drawn AFTER lines = On Top) -->
    <g id="components">
        <!-- Rect Group -->
         <!-- CP -->
        <g transform="translate(100, 500)">
          <rect width="50" height="100" class="component" />
          <text x="25" y="50" text-anchor="middle" dominant-baseline="middle" class="label">PC</text>
        </g>
        <!-- Instruction Memory Group -->
        <g transform="translate(190, 530)">
          <rect width="130" height="200" class="component" />
          <!-- Chia thành 2 dòng dùng 2 text element -->
          <text x="60" y="125" class="label">Instruction</text> <!-- x=width/2 -->
          <text x="60" y="140" class="label">memory</text>    <!-- y gần đáy -->
      
          <!-- Nhãn phụ "Read address" (ở trên, căn giữa) -->
          <!-- Chia thành 2 dòng -->
          <text x="60" y="20" class="mem-label">Read</text>     <!-- x=width/2 -->
          <text x="60" y="35" class="mem-label">address</text>  <!-- y gần đỉnh -->
      
          <!-- Nhãn phụ "Instruction [31-0]" (ở giữa, căn giữa) -->
          <!-- Chia thành 2 dòng -->
          <text x="60" y="70" class="mem-label">Instruction</text> <!-- x=width/2 -->
          <text x="60" y="85" class="mem-label">[31-0]</text>   <!-- y gần giữa -->
      
        </g>
        <!-- data memory  -->
        <g transform="translate(580, 520)">
          <rect width="170" height="220" class="component" />
          <text x="50" y="50" text-anchor="middle" dominant-baseline="middle" class="label">Data Memory</text>
        </g>
        <!-- Register  -->
        <g transform="translate(1150, 610)">
          <rect width="140" height="200" class="component" />
          <text x="50" y="50" text-anchor="middle" dominant-baseline="middle" class="label">Data Memory</text>
        </g>
        <!-- Flag -->
        <g transform="translate(880, 500)">
          <rect x="0" y="0" width="140" height="30" class="component"/>
          <line x1="35" y1="0" x2="35" y2="30" class="component"/>
          <line x1="70" y1="0" x2="70" y2="30" class="component"/>
          <line x1="105" y1="0" x2="105" y2="30" class="component"/>

          <text x="12" y="15" class="flag-label">N</text>
          <text x="47" y="15" class="flag-label">Z</text>
          <text x="82" y="15" class="flag-label">C</text>
          <text x="117" y="15" class="flag-label">V</text>
      
        </g>

        <!-- Alu Group -->
        <!-- Add topleft -->
        <g transform="translate(300, 57)">
          <polygon points="0,25 0,0 40,19 40,51 0,70 0,45 13,35" transform = "scale(1.75)" class="component"/>
          <text x="40" y="50" class="label">Add</text>
        </g>
        <!-- Add top right -->
        <g transform="translate(980, 130)">
          <polygon points="0,25 0,0 40,19 40,51 0,70 0,45 13,35" transform = "scale(2.10)" class="component"/>
          <text x="40" y="50" class="label">Add</text>
        </g>
        <!-- ALU -->
        <g transform="translate(890, 540)">
          <polygon points="0,25 0,0 40,19 40,51 0,70 0,45 13,35" transform = "scale(2.5)" class="component"/>
          <text x="40" y="50" class="label">Add</text>
        </g>
        <!-- End Alu Group -->

        <!-- Circle -->
        <!-- Control Group -->
        <g transform="translate(490, 335)">
              <!-- Hình Ellipse -->
            <!-- cx, cy là tâm tương đối so với điểm (0,0) của group transform -->
            <!-- rx, ry là bán kính ngang và dọc -->
            <ellipse cx="70" cy="50" rx="50" ry="120" class="component" />
            <!-- Chữ "Control" ở giữa ellipse -->
            <text x="70" y="50" class="label">Control</text>
        </g>

        <g transform="translate(900, 250)">
          <circle cx="0" cy="0" r="40" class="component"/>
          <text x="0" y="0" class="label">Shift</text>
          <text x="0" y="10" class="label">left 2</text>
        </g>

        <g transform="translate(680, 840)">
          <circle cx="0" cy="0" r="50" class="component"/>
          <text x="0" y="0" class="label">Sign-</text>
          <text x="0" y="10" class="label">Extend</text>
        </g>

        <g transform="translate(890, 860)">
          <circle cx="0" cy="0" r="50" class="component"/>
          <text x="0" y="0" class="label">ALU</text>
          <text x="0" y="10" class="label">Control</text>
        </g>

        <g transform="translate(1280, 100)">
          <!-- Hình dạng viên thuốc (Rectangle với góc bo tròn tối đa) -->
          <!-- width và height có thể cần điều chỉnh tỷ lệ -->
          <!-- rx = width/2 để bo tròn hoàn toàn theo chiều ngang -->
          <!-- ry = rx để đảm bảo bo tròn đẹp ở góc -->
          <rect x="0" y="0" width="40" height="120" rx="20" ry="20" class="component"/>
          <text x="20" y="18" class="mux-select-label">0</text>
          <text x="20" y="38" class="label">M</text>
          <text x="20" y="53" class="label">u</text>
          <text x="20" y="68" class="label">x</text>
          <text x="20" y="88" class="mux-select-label">1</text>
        </g>

        <g transform="translate(1335, 665)">
          <rect x="0" y="0" width="40" height="100" rx="20" ry="20" class="component"/>
          <text x="20" y="18" class="mux-select-label">0</text>
          <text x="20" y="38" class="label">M</text>
          <text x="20" y="53" class="label">u</text>
          <text x="20" y="68" class="label">x</text>
          <text x="20" y="88" class="mux-select-label">1</text>
        </g>

        <g transform="translate(520, 555)">
          <rect x="0" y="0" width="40" height="100" rx="20" ry="20" class="component"/>
          <text x="20" y="18" class="mux-select-label">0</text>
          <text x="20" y="38" class="label">M</text>
          <text x="20" y="53" class="label">u</text>
          <text x="20" y="68" class="label">x</text>
          <text x="20" y="88" class="mux-select-label">1</text>
        </g>

        <g transform="translate(820, 630)">
          <rect x="0" y="0" width="40" height="100" rx="20" ry="20" class="component"/>
          <text x="20" y="18" class="mux-select-label">0</text>
          <text x="20" y="38" class="label">M</text>
          <text x="20" y="53" class="label">u</text>
          <text x="20" y="68" class="label">x</text>
          <text x="20" y="88" class="mux-select-label">1</text>
        </g>

          <!-- Các nhãn tín hiệu Control Output -->
          <!-- Đặt ở tọa độ tuyệt đối trên SVG canvas -->
          <!-- Sử dụng lại tọa độ x, y từ code gốc của bạn hoặc điều chỉnh -->
          <!-- x="440" là vị trí bắt đầu ngang của tất cả các nhãn -->
          <!-- y="..." thay đổi để xếp các nhãn theo chiều dọc, cách đều 15 đơn vị -->
          <!-- <text x="440" y="255" class="label-start">Reg2Loc</text>
          <text x="440" y="270" class="label-start">UncondBranch</text>
          <text x="440" y="285" class="label-start">FlagBranch</text>
          <text x="440" y="300" class="label-start">ZeroBranch</text>
          <text x="440" y="315" class="label-start">MemRead</text>
          <text x="440" y="330" class="label-start">MemToReg</text>
          <text x="440" y="345" class="label-start">MemWrite</text>
          <text x="440" y="360" class="label-start">FlagWrite</text>
          <text x="440" y="375" class="label-start">ALUSrc</text>
          <text x="440" y="390" class="label-start">ALUOp</text>
          <text x="440" y="405" class="label-start">RegWrite</text> -->

          <!-- Chỗ để vẽ các đường tín hiệu vào/ra sau này -->
          <!-- Ví dụ đường ra từ ellipse đến nhãn Reg2Loc -->
          <!-- <line x1="350" y1="255" x2="440" y2="255" class="signal-line" /> -->
          <!-- (350 = translate_x + cx + rx = 280 + 70 + 0) -->
          <!-- Hoặc bạn có thể vẽ path phức tạp hơn -->
          <!-- <path d="M 350 255 H 440" class="signal-line" /> -->


        
    </g> <!-- End Components Layer -->

    <!-- Signal Lines Layer -->
    <g id="signal-lines">

      <!-- Đường đi thật để dùng cho animation -->
      <path id="motion-path" 
            d="M90,385 L90,92.5 L100,92.5" 
            fill="none" 
            stroke="black" />

      <!-- Chấm tròn di chuyển theo đường path -->
      <circle id = "point" r="5" fill="red" visibility="hidden">
        <animateMotion id = "animationDot" dur="2s" rotate="auto" fill="freeze" begin="indefinite">
          <mpath href="#motion-path" />
        </animateMotion>
      </circle>
    </g>

  </svg>
  </div>
</div>

<script src="./Scripts/handleLinePath.js"></script>

</body>
</html>