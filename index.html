<!DOCTYPE html>
<html>
<head>
<title> LEGv8 Visual Simulator - HCMUS </title>
<link rel = "stylesheet" href = "Styles/styles.css">
</head>
<body>

<div class="header">
  <h2>LEGv8 Visual Simulator</h2>

  <button id = "themeToggle">🌙 Dark Mode</button>
</div>

<div class = "codeAndFrameContainer">
  <div class = "frameBox">
    <h2>Frame</h2>

    <div class = "frame" id = "zoomFrame">
      <div class = "content" id = "zoomContent">
      <svg viewBox = "0 0 2000 1000">
        <!-- Signal Lines Layer -->
        <g id = "signal-lines">

          <defs>
            <marker id = "circle" markerWidth = "8" markerHeight = "8" refX = "5" refY = "5">
              <circle cx = "5" cy = "5" r = "2" fill = "context-stroke" />
            </marker>
            <marker id = "arrow" markerWidth = "4" markerHeight = "4" refX = "2" refY = "2" orient = "auto">
              <path d = "M0,0 L4,2 L0,4 z" fill = "context-stroke" />
            </marker>
          </defs>

          <!-- Đường đi thật để dùng cho animation -->
          <!-- pc -->
          <path id         = "pc-to-instruction-memory-path" 
                d          = "M153,550 L282,550" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />

          <path id         = "pc-to-ALU-add-0-path" 
                d          = "M153,550 L215,550 L215,75 L292,75" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M215,550"
                class      = "signal-line"
                marker-end = "url(#circle)" />
          
          <path id         = "pc-to-ALU-add-1-path" 
                d          = "M153,550 L215,550 L215,200 L400,200 L400,150 L1170,150" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M215,200"
                class      = "signal-line"
                marker-end = "url(#circle)" />

          <!-- const 4 -->
          <path id         = "const-4-to-ALU-add-0-path" 
                d          = "M250,150 L292,150" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />

          <!-- ALU-add-id -->
          <path id         = "ALU-add-0-to-mux-0-0-path" 
                d          = "M370,120 L1472,120" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />

          <path id         = "ALU-add-1-to-mux-0-1-path" 
                d          = "M1265,200 L1475,200" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
              
          <path id         = "ALU-add-2-to-data-memory-path"
                d          = "M1090,650 L1340,650"
                class      = "signal-line"
                marker-end = "url(#arrow)" />
          
          <path id         = "ALU-add-2-to-mux-3-0-path"
                d          = "M1090,650 L1270,650 L1270,850 L1510,850 L1510,750 L1530,750"
                class      = "signal-line"
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M1270,650"
                class      = "signal-line"
                marker-end = "url(#circle)" />
          
          <path id         = "ALU-add-2-zero-path"
                d          = "M1090,600 L1220,600 L1220,520 L1250,520"
                class      = "control-signal-line" />

          <!-- mux-id-status -->
          <path id         = "mux-0-to-pc-path" 
                d          = "M1522,160 L1550,160 L1550,30 L60,30 L60,550 L92,550" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />

          <path id         = "mux-1-to-register-path" 
                d          = "M710,600 L775,600" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          
          <path id         = "mux-2-to-register-path" 
                d          = "M1065,680 L1080,680" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />      
          
          <path id         = "mux-3-to-register-path" 
                d          = "M1575,715 L1600,715 L1600,965 L725,965 L725,710 L775,710" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />

          <!-- sign-extend -->
          <path id         = "sign-extend-to-shift-left-2-path" 
                d          = "M930,840 L990,840 L990,250 L1050,250" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />

          <path id         = "sign-extend-to-mux-2-1-path" 
                d          = "M930,840 L990,840 L990,710 L1010,710" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M990,710"
                class      = "signal-line"
                marker-end = "url(#circle)" />

          <!-- shift-left-2 -->
          <path id         = "shift-left-2-to-add-1-path" 
                d          = "M1140,250 L1170,250" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />

          <!-- instruction-memory -->
          <path id         = "instruction-memory-to-control-path" 
                d          = "M420,630 L490,630 L490,380 L655,380" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M490,630"
                class      = "signal-line"
                marker-end = "url(#circle)" />

          <path id         = "instruction-memory-to-read-register-1-path" 
                d          = "M420,630 L490,630 L490,540 L775,540" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M490,540"
                class      = "signal-line"
                marker-end = "url(#circle)" />

          <path id         = "instruction-memory-to-mux-1-0-path" 
                d          = "M420,630 L490,630 L490,570 L665,570" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M490,570"
                class      = "signal-line"
                marker-end = "url(#circle)" />
          
          <path id         = "instruction-memory-to-mux-1-1-path" 
                d          = "M420,630 L490,630 L490,670 L580,670 L580,640 L665,640" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M490,670"
                class      = "signal-line"
                marker-end = "url(#circle)" />
          <path id         = temporary-circle
                d          = "M580,670"
                class      = "signal-line"
                marker-end = "url(#circle)" />
                
          <path id         = "instruction-memory-to-write-register-path" 
                d          = "M420,630 L490,630 L490,670 L775,670" 
                class      = "signal-line" 
                marker-end = "url(#arrow)" />
          
          <path id         = "instruction-memory-to-sign-extend-path"
                d          = "M420,630 L490,630 L490,840 L825,840"
                class      = "signal-line"
                marker-end = "url(#arrow)" />

          <path id         = "instruction-memory-to-alu-control-path"
                d          = "M420,630 L490,630 L490,840 L750,840 L750,940 L1000,940 L1000,860 L1030,860"
                class      = "signal-line"
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M750,840"
                class      = "signal-line"
                marker-end = "url(#circle)" />

          <!-- register -->
          <path id         = "register-to-mux-2-0-path"
                d          = "M950,650 L1010,650"
                class      = "signal-line"
                marker-end = "url(#arrow)" />
          
          <path id         = "register-to-ALU-add-2-path"
                d          = "M950,560 L1080,560"
                class      = "signal-line"
                marker-end = "url(#arrow)" />
          
          <path id         = "register-to-data-memory-path"
                d          = "M950,650 L970,650 L970,770 L1340,770"
                class      = "signal-line"
                marker-end = "url(#arrow)" />
          <path id         = temporary-circle
                d          = "M970,650"
                class      = "signal-line"
                marker-end = "url(#circle)" />

          <!-- data-memory -->
          <path id         = "data-memory-to-mux-3-1-path"
                d          = "M1490,680 L1530,680"
                class      = "signal-line"
                marker-end = "url(#arrow)" />

          <!-- control -->
          <path id         = "control-reg2loc-path"
                d          = "M730,275 L770,275 L770,230 L450,230 L450,750 L690,750 L690,655"
                class      = "control-signal-line" />

          <path id         = "control-uncondbranch-path"
                d          = "M730,300 L1300,300 L1300,260 L1390,260"
                class      = "control-signal-line" />

          <path id         = "control-branch-path"
                d          = "M730,325 L1220,325 L1220,480 L1250,480"
                class      = "control-signal-line" />

          <path id         = "control-memread-path"
                d          = "M730,350 L1650,350 L1650,870 L1420,870 L1420,810"
                class      = "control-signal-line" />

          <path id         = "control-memtoreg-path"
                d          = "M730,375 L1555,375 L1555,665"
                class      = "control-signal-line" />

          <path id         = "control-aluop-path"
                d          = "M730,400 L980,400 L980,950 L1090,950 L1090,910"
                class      = "ALU-control-signal-line" />

          <path id         = "control-memwrite-path"
                d          = "M730,425 L1420,425 L1420,610"
                class      = "control-signal-line" />

          <path id         = "control-alusrc-path"
                d          = "M730,450 L1040,450 L1040,630"
                class      = "control-signal-line" />

          <path id         = "control-regwrite-path"
                d          = "M730,475 L870,475 L870,520"
                class      = "control-signal-line" />

          <!-- ALU-control -->
          <path id         = "ALU-control-to-ALU-2-path"
                d          = "M1130,860 L1150,860 L1150,670"
                class      = "ALU-control-signal-line" />

          <!-- AND gate -->
          <path id         = "AND-gate-to-OR-gate-path"
                d          = "M1330,500 L1350,500 L1350,290 L1390,290"
                class      = "control-signal-line" />

          <!-- OR gate -->
          <path id         = "OR-gate-to-mux-0-1-path"
                d          = "M1450,280 1500,280 1500,200"
                class      = "control-signal-line" />

          <g id="control-signal-nodes">
            <!-- Các node 0/1 sẽ được thêm vào đây bằng JavaScript -->
          </g>

          
          <g id="data-signal-nodes">
            <!-- Các node 0/1 sẽ được thêm vào đây bằng JavaScript -->
          </g>

          <!-- Chấm tròn di chuyển theo đường path -->
          <circle id = "point" r="5" fill="red" visibility="hidden">
            <animateMotion id = "animationDot" dur="2s" rotate="auto" fill="freeze" begin="indefinite">
              <mpath href="#pc-to-ALU-add-0-path" />
            </animateMotion>
          </circle>
        </g>

        <!-- Components Layer (Drawn AFTER lines = On Top) -->
        <g id="components">
          <!-- pc -->
          <g id="pc" transform = "translate(100, 500)">
            <rect width = "50" height = "100" class = "component" />

            <text x = "25" y = "50" class = "label"> PC </text>
            <text id="pc-value-text" x = "20" y = "125" class="instruction"></text>
          </g>

          <!-- instruction-memory -->
          <g id="instruction-memory" transform = "translate(290, 530)">
            <rect width = "130" height = "200" class = "component" />

            <text x = "65" y = "165" class = "label"> Instruction </text> 
            <text x = "65" y = "185" class = "label"> memory</text>
        
            <text x = "5"  y = "20"  class = "mem-label"> Read </text>
            <text x = "5"  y = "40"  class = "mem-label"> address </text>

            <text x = "35" y = "95"  class = "mem-label"> Instruction </text> 
            <text x = "75" y = "115" class = "mem-label"> [31-0] </text> 
            
            <text x = "205" y = "-160" class = "mem-label"> Instruction [31-21] </text> 

            <text x = "205" y = "0"    class = "mem-label"> Instruction [9-5] </text> 

            <text x = "205" y = "30"   class = "mem-label"> Instruction [20-16] </text> 

            <text x = "205" y = "165"  class = "mem-label"> Instruction [4-0] </text> 

            <text x = "205" y = "300"  class = "mem-label"> Instruction [31-0] </text> 

            <text x = "465" y = "400"  class = "mem-label"> Instruction [31-21] </text> 
          </g>

          <!-- register  -->
          <g id="register" transform = "translate(780, 520)">
            <rect width = "170" height = "220" class = "component" />

            <text x = "115" y = "205" class = "label"> Registers </text>

            <text x = "5"   y = "20"  class = "mem-label"> Read </text>
            <text x = "5"   y = "40"  class = "mem-label"> register 1 </text>
              
            <text x = "5"   y = "75"  class = "mem-label"> Read </text>
            <text x = "5"   y = "95"  class = "mem-label"> register 2 </text>
      
            <text x = "5"   y = "145" class = "mem-label"> Write </text>
            <text x = "5"   y = "165" class = "mem-label"> register </text>
              
            <text x = "5"   y = "190" class = "mem-label"> Write </text>
            <text x = "5"   y = "210" class = "mem-label"> data </text>

            <text x = "115" y = "40"  class = "mem-label"> Read </text>
            <text x = "110" y = "60"  class = "mem-label"> data 1 </text>

            <text x = "115" y = "130" class = "mem-label"> Read </text>
            <text x = "110" y = "150" class = "mem-label"> data 2 </text>
          </g>

          <!-- data-memory  -->
          <g id="data-memory" transform = "translate(1350, 610)">
            <rect width = "140" height = "200" class = "component" />

            <text x = "110" y = "165" class = "label"> Data </text>
            <text x = "90"  y = "185" class = "label"> memory </text>

            <text x = "5"   y = "45"  class = "mem-label"> Address </text>

            <text x = "5"   y = "155" class = "mem-label"> Write </text>
            <text x = "5"   y = "175" class = "mem-label"> data </text>

            <text x = "85"  y = "65"  class = "mem-label"> Read </text>
            <text x = "95"  y = "85"  class = "mem-label"> data </text>
          </g>
          
          <!-- ALU -->
          <!-- add-0 -->
          <g id="add-0" transform = "translate(300, 57)">
            <polygon points = "0,25 0,0 40,19 40,51 0,70 0,45 13,35" transform = "scale(1.75)" class = "component"/>

            <text x = "46"  y = "62" class = "label"> Add </text>
            <text x = "-60" y = "95" class = "label"> 4 </text>
          </g>

          <!-- add-1 -->
          <g id="add-1" transform = "translate(1180, 130)">
            <polygon points = "0,25 0,0 40,19 40,51 0,70 0,45 13,35" transform = "scale(2.10)" class = "component"/>

            <text x = "55" y = "75" class = "label"> Add </text>
          </g>

          <!-- add-2 -->
          <g id="add-2" transform = "translate(1090, 540)">
            <polygon points = "0,25 0,0 40,19 40,51 0,70 0,45 13,35" transform = "scale(2.5)" class = "component"/>

            <text x = "60" y = "90" class = "label"> ALU </text>
            
            <text x = "50" y = "65" class = "mem-control-label"> Zero </text>
            
          </g>
          <!-- End Alu -->

          <!-- control -->
          <g id="control" transform = "translate(640, 335)">
              <ellipse cx = "70" cy = "50" rx = "50" ry = "120" class = "control-component" />
              
              <text x = "70" y = "50" class = "control-label"> Control </text>
              
              <text x = "140" y = "-65" class = "mem-control-label"> Reg2Loc </text>
              <text x = "140" y = "-40" class = "mem-control-label"> Uncondbranch </text>
              <text x = "140" y = "-15" class = "mem-control-label"> Branch </text>
              <text x = "140" y = "10"  class = "mem-control-label"> MemRead </text>
              <text x = "140" y = "35"  class = "mem-control-label"> MemtoReg </text>
              <text x = "140" y = "60"  class = "mem-control-label"> ALUOp </text>
              <text x = "140" y = "85"  class = "mem-control-label"> MemWrite </text>
              <text x = "140" y = "110" class = "mem-control-label"> ALUSrc </text>
              <text x = "140" y = "135" class = "mem-control-label"> RegWrite </text>
          </g>

          <!-- shift-left-2 -->
          <g id="shift-left-2" transform = "translate(1100, 250)">
            <circle cx = "0" cy = "0" r = "40" class = "component"/>
            
            <text x = "0" y = "-10" class = "label"> Shift </text>
            <text x = "0" y = "10"  class = "label"> left 2 </text>
          </g>

          <!-- sign-extend -->
          <g id="sign-extend" transform = "translate(880, 840)">
            <circle cx = "0" cy = "0" r = "50" class = "component"/>
            
            <text x = "0" y = "-10" class = "label"> Sign- </text>
            <text x = "0" y = "10"  class = "label"> extend </text>

            <text x = "-100" y = "-20" class = "mem-label"> 32 </text> 
            <text x = "-90" y = "0"   class = "label"> ╲ </text> 
            <text x = "70"   y = "-20" class = "mem-label"> 64 </text> 
            <text x = "80"   y = "0"   class = "label"> ╲ </text> 
          </g>

          <!-- ALU-control -->
          <g id="ALU-control" transform = "translate(1090, 860)">
            <ellipse cx = "0" cy = "0" rx = "50" ry = "70" class = "control-component" />

            <text x = "0" y = "-10" class = "control-label"> ALU </text>
            <text x = "0" y = "10"  class = "control-label"> Control </text>
          </g>

          <!-- mux-0 -->
          <g id="mux-0" transform = "translate(1480, 100)">
            <rect x = "0"  y = "0" width = "40" height = "120" rx = "20" ry = "20" class = "component"/>
            
            <text x = "14" y = "20"  class = "mem-label"> 0 </text>
            <text x = "20" y = "40"  class = "label">     M </text>
            <text x = "20" y = "60"  class = "label">     u </text>
            <text x = "20" y = "80"  class = "label">     x </text>
            <text x = "14" y = "110" class = "mem-label"> 1 </text>
          </g>
          
          <!-- mux-1 -->
          <g id="mux-1" transform = "translate(670, 555)">
            <rect x = "0"  y = "0" width = "40" height = "100" rx = "20" ry = "20" class = "component"/>
            
            <text x = "14" y = "20" class = "mem-label"> 0 </text>
            <text x = "20" y = "35" class = "label">     M </text>
            <text x = "20" y = "50" class = "label">     u </text>
            <text x = "20" y = "65" class = "label">     x </text>
            <text x = "14" y = "90" class = "mem-label"> 1 </text>
          </g>
          
          <!-- mux-2 -->
          <g id="mux-2" transform = "translate(1020, 630)">
            <rect x = "0"  y = "0" width = "40" height = "100" rx = "20" ry = "20" class = "component"/>
            
            <text x = "14" y = "20" class = "mem-label"> 0 </text>
            <text x = "20" y = "35" class = "label">     M </text>
            <text x = "20" y = "50" class = "label">     u </text>
            <text x = "20" y = "65" class = "label">     x </text>
            <text x = "14" y = "90" class = "mem-label"> 1 </text>
          </g>
          
          <!-- mux-3 -->
          <g id="mux-3" transform="translate(1535, 665)">
            <rect x = "0"  y = "0" width = "40" height = "100" rx = "20" ry = "20" class = "component"/>
            
            <text x = "14" y = "20" class = "mem-label"> 1 </text>
            <text x = "20" y = "35" class = "label">     M </text>
            <text x = "20" y = "50" class = "label">     u </text>
            <text x = "20" y = "65" class = "label">     x </text>
            <text x = "14" y = "90" class = "mem-label"> 0 </text>
          </g>

          <!-- AND gate -->
          <g id="and-gate" transform="translate(1250, 450)">
            <path d="M0,0 L40,0 A40,50 0 0,1 40,100 L0,100 Z"
                  stroke="deepskyblue" class="control-component" />
          </g>

          <!-- OR gate -->
          <g id="or-gate" transform="translate(1370, 230)">
            <path d="M0,0 Q40,40 0,100 Q50,100 80,50 Q50,0 0,0"
                  stroke="deepskyblue" class="control-component" />
          </g>  
      </g> <!-- End Components Layer -->

      </svg>
      </div>
    </div>
  </div>
  
  <div class = "codeBox">
    <h2>Code</h2>
    
    <form id = "codeForm" >
      <!-- Add id="instructionCode" to the textarea -->
      <div class = "code-editor">
        <div class = "line-numbers" id = "lineNumbers"> 1 </div>
        <textarea id = "instructionCode" name="message" rows="36" cols="30" placeholder="Enter LEGv8 code here, one instruction per line...">ADD X9, X20, X21</textarea>
      </div>
      <button id = "parseInstructions">Parse Instructions</button>
    </form>
  </div>
</div>

<div class = "outputContainer">
  <div class = "parsedOutputBox">
    <h2>Parsed Output</h2>
    
    <!-- Muốn hiển thị lại parsedOutput thuần thì phải vào script.js mở code lại nha -->
    <!-- <pre id="parsedOutput" rows="10" cols="50"></pre> -->
    
    <table class = "parsedOutputTable" style = "border-collapse: collapse; width: 100%;">
      <thead>
        <tr>
          <th>Line</th>
          <th>Mnemonic</th>
          <th>Type</th>
          <th>Rd</th>
          <th>Rn</th>
          <th>Rm</th>
          <th>Error</th>
        </tr>
      </thead>
      <tbody id = "parsedOutputTable">

      </tbody>
    </table>
  </div>

  <div class = "registersBox">
    <h2>Flags</h2>
    
    <table class = "parsedOutputTable" style = "border-collapse: collapse; width: 100%;">
      <thead>
        <tr>
          <th>N</th>
          <th>Z</th>
          <th>V</th>
          <th>C</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <th>0</th>
          <th>0</th>
          <th>0</th>
        </tr>
      </tbody>
    </table>

    <h2>Registers</h2>

    <table class = "parsedOutputTable" style = "border-collapse: collapse; width: 100%;">
      <thead>
        <tr>
          <th>X1</th>
          <th>0x0000</th>
          <th>X2</th>
          <th>0x0000</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    </div>
</div>
  
<script type="module" src="./Scripts/script.js"></script>

<div class="footer">
  Author: 23120015 - 23120304 (HCMUS - Honor Program) © 2025 LEGv8 Visual Simulator. All rights reserved.
</div>

</body>
</html>